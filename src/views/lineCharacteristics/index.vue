<template>
  <div class="lineCharacteristicsc" id="lineCharacteristics">
    <div style="margin-top:100px;position:fixed;z-index:100">
        <el-button @click="judgeradius" type="primary">主要按钮</el-button>
    </div>
    <router-view @changefun="sonClick"></router-view>
  </div>
</template>

<script>
import Map from "@/libs/myMap.js";
let MyMap = null; // 地图实例
export default {
  data(){
    return{
      kyline:[121.519582,31.244213,121.519504,31.241951,121.519706,31.240515,121.520005,31.239596,121.520566,31.238437,121.522564,31.234565,121.524342,31.231122,121.525827,31.227642,121.527369,31.223936,121.5288,31.220249,121.529217,31.218594,121.529336,31.216774,121.529217,31.21494,121.528592,31.213133,121.527758,31.211611,121.52685,31.209842,121.525213,31.206825,121.523456,31.203604,121.521253,31.199657,121.518743,31.194945,121.516408,31.192784,121.513805,31.191212,121.510819,31.189607],
      datapddd:[121.510615,31.237981,121.512986,31.238665,121.515244,31.239334,121.517633,31.240008,121.519721,31.240508,121.52207,31.240639,121.524248,31.240683,121.527352,31.240716,121.529286,31.24085,121.531596,31.241452,121.534429,31.242316,121.540049,31.243945,121.542715,31.245013,121.544872,31.245921,121.549006,31.248307,121.549638,31.248833,121.550228,31.249387,121.551458,31.250605,121.553183,31.252468,121.553985,31.253324,121.554798,31.254231,121.555776,31.255274,121.556253,31.25583,121.557292,31.256395,121.558533,31.2571,121.561366,31.258797,121.563322,31.260006,121.564747,31.26103,121.56649,31.262572,121.568665,31.264504,121.570657,31.266341,121.574254,31.269216,121.575474,31.270385,121.576022,31.271436,121.576089,31.271975,121.5761,31.272562,121.576432,31.273845,121.577371,31.276214,121.577061,31.276285,121.577055,31.277137,121.576817,31.279075,121.576779,31.279411,121.576651,31.279874,121.575952,31.283497,121.575746,31.283881,121.575606,31.284201,121.57409,31.28692,121.572948,31.288887,121.571844,31.290599,121.571395,31.290991,121.570908,31.291694],
      datagkl:[121.495843,31.189465,121.497706,31.188265,121.499475,31.186958,121.500374,31.186296,121.502666,31.184917,121.50388,31.184335,121.504623,31.184264,121.505533,31.184272,121.506821,31.184622,121.509102,31.185445,121.510776,31.185964,121.513685,31.186833,121.517201,31.187039,121.518394,31.187334,121.52033,31.187871,121.523752,31.187674,121.525113,31.187504,121.52775,31.187442,121.530868,31.187477,121.533756,31.187522,121.538267,31.187549,121.539993,31.187585,121.54493,31.187546,121.545964,31.187604,121.54663,31.187624,121.550352,31.188253,121.551477,31.188361,121.552637,31.188469,121.556231,31.188999,121.560573,31.189453,121.562204,31.189689,121.564133,31.189925,121.567664,31.190357,121.569639,31.190534,121.572923,31.191202,121.574565,31.191732,121.57538,31.191987,121.579215,31.193362,121.589323,31.196146,121.595521,31.197227,121.60054,31.198031,121.610288,31.198086,121.612302,31.198141,121.615878,31.198296,121.618926,31.19887,121.621236,31.199444,121.624799,31.200493,121.634647,31.203225,121.638181,31.204214,121.644136,31.206658,121.646623,31.20774,121.655525,31.212585,121.657707,31.213891,121.662615,31.215589,121.666389,31.216316,121.674619,31.217534,121.67577,31.217762,121.677188,31.218021,121.680995,31.218587,121.683308,31.218925,121.687898,31.219681,121.690699,31.219949,121.693489,31.220277,121.697007,31.220721,121.69873,31.220941,121.703726,31.221578,121.714055,31.223462,121.716956,31.224157,121.7202,31.224678,121.72543,31.22532,121.729906,31.225828,121.734282,31.22632],
      datazddl:[121.605618,31.115605,121.614993,31.117303,121.619771,31.118255,121.624693,31.119208,121.628299,31.119541,121.630288,31.119581,121.632595,31.119761,121.635751,31.119962,121.637024,31.12004,121.645519,31.120481,121.646685,31.120491,121.649784,31.120717,121.651499,31.120956,121.652889,31.121177,121.656003,31.121784,121.658768,31.122318,121.660072,31.122574,121.662594,31.123081,121.663918,31.123286,121.665472,31.123431,121.668,31.123566,121.672101,31.123638,121.67353,31.123671,121.674659,31.123703,121.681996,31.123822,121.683992,31.123888,121.688576,31.124479,121.691526,31.12522,121.693066,31.125715,121.695157,31.126429,121.696335,31.126741
      ],
      datahagl:[121.597799,31.026324,121.600092,31.025791,121.60255,31.025425,121.604252,31.025438,121.608726,31.026215,121.610142,31.026485,121.611506,31.026748,121.612128,31.026832,121.613831,31.027085,121.61538,31.027059,121.619937,31.026341,121.620678,31.026216,121.623327,31.025711,121.62672,31.025222,121.629533,31.025424,121.631817,31.025642,121.634616,31.025925,121.637598,31.026223,121.639109,31.026484,121.640492,31.026859,121.64275,31.027528,121.645296,31.028432,121.647872,31.028976,121.650548,31.029321,121.654177,31.029875,121.658631,31.03062,121.663702,31.031596,121.665058,31.031768,121.66813,31.032431,121.669143,31.032666,121.669867,31.032842,121.672254,31.033325,121.675947,31.033893,121.678734,31.034304,121.687018,31.03549,121.692273,31.036233,121.695253,31.036645,121.698309,31.037089,121.69975,31.03721,121.703705,31.037436,121.709715,31.037578,121.710265,31.037624,121.714725,31.037449,121.715694,31.037467,121.718226,31.03731,121.725402,31.038434,121.726204,31.038583,121.728775,31.039188,121.732041,31.040038,121.735664,31.040213,121.737383,31.040422,121.740141,31.040469,121.742191,31.04038,121.743457,31.040315,121.744524,31.040145,121.748828,31.040265,121.749465,31.040336,121.751166,31.040417,121.752203,31.040566,121.753686,31.040847,121.754537,31.040917,121.755378,31.040956,121.756323,31.040938,121.757288,31.041051,121.760136,31.041549,121.7612,31.041733,121.762098,31.041897,121.763511,31.042088,121.768133,31.041934,121.768838,31.041934,121.771413,31.041797,121.775546,31.041626,121.779633,31.041482,121.780903,31.041498,121.783152,31.041418,121.786539,31.041322,121.789454,31.041252,121.792452,31.041222,121.795398,31.041069,121.797285,31.041536,121.801675,31.04151,121.803314,31.041395,121.804373,31.041352,121.808315,31.041093
      ,121.809105,31.041091,121.810563,31.040815,121.81211,31.040262,121.816194,31.037773,121.817029,31.037286,121.818398,31.036714,121.820379,31.036161,121.824497,31.036008,121.825922,31.036113,121.833329,31.036123,121.834686,31.036171,121.838498,31.036653,121.841583,31.037233,121.845213,31.037938,121.850351,31.038864,121.852247,31.039309,121.85439,31.039585,121.859109,31.040438
      ],
      dataPjl:[121.5123,31.212402,121.514183,31.211466,121.517034,31.21053,121.519064,31.209487,121.519664,31.209055,121.5212,31.208677,121.523615,31.208087,121.525693,31.207946,121.528912,31.207779,121.53197,31.207627,121.535299,31.207621,121.536766,31.207358,121.538461,31.207169,121.539663,31.20695,121.540397,31.206826,121.541147,31.206505,121.542503,31.205615,121.543484,31.204849,121.543962,31.204346,121.544661,31.203412,121.545497,31.202288,121.546427,31.200875,121.547126,31.19973],
      datahnl:[121.547151,31.199481,121.550063,31.193065,121.551165,31.190902,121.552765,31.18857,121.553705,31.186213,121.554754,31.183045,121.555597,31.181049,121.556939,31.177589,121.557506,31.175371,121.558203,31.173444,121.559043,31.171845,121.559639,31.170883,121.56029,31.169631,121.560678,31.168836,121.561504,31.167279,121.562667,31.164876,121.562929,31.164149,121.563234,31.163074,121.563625,31.160932,121.563755,31.159982,121.563873,31.159071,121.564024,31.15752,121.564137,31.156664,121.564372,31.155498,121.56464,31.154691,121.564929,31.153697,121.565223,31.152944,121.565713,31.15147,121.566118,31.15009,121.566662,31.14851,121.566939,31.14761,121.567274,31.146477,121.567412,31.145232,121.567455,31.144618,121.567525,31.141828,121.567472,31.140005,121.567472,31.136694,121.567497,31.135952,121.567377,31.134733,121.567219,31.133631,121.567072,31.131203,121.566963,31.13038,121.566836,31.129146,121.566565,31.12743,121.566506,31.125533,121.56655,31.124557,121.566754,31.122153,121.567061,31.119527,121.567138,31.11843,121.567197,31.11762,121.567244,31.117473,121.567341,31.11616,121.567611,31.114243,121.567768,31.113373,121.568501,31.110439,121.568949,31.108747,121.570029,31.104451,121.570319,31.103491,121.570571,31.102723,121.571075,31.100741,121.571645,31.099071,121.572278,31.097889,121.572687,31.097279,121.573583,31.09631,121.574376,31.095552,121.575317,31.094838,121.576701,31.093846,121.578259,31.092772,121.578983,31.092332,121.579481,31.091918,121.580742,31.091058,121.581976,31.089889,121.582311,31.089345,121.583137,31.088016,121.583795,31.086478,121.584096,31.085455,121.584208,31.084777,121.584724,31.082588,121.58516,31.079207,121.585521,31.076243,121.585811,31.07328,121.586034,31.071827,121.586477,31.068466,121.586609,31.067109,121.587194,31.06455,121.587508,31.06321,121.588124,31.06115,121.588388,31.059736,121.589022,31.054391,121.589399,31.05134,121.589716,31.048734,121.590128,31.04805,121.590506,31.047682,121.591523,31.046443,121.592374,31.045516,121.593662,31.043853,121.594244,31.042538,121.594805,31.041037,121.595318,31.039594,121.59657,31.036224,121.597318,31.033786,121.59792,31.032323,121.598132,31.031277,121.59801,31.029536,121.597853,31.02793,121.597882,31.026222,121.599315,31.02599,121.602102,31.025464,121.6042,31.025416,121.608381,31.026172,121.611382,31.026634,121.611984,31.02682,121.613506,31.027037,121.614756,31.027101,121.615553,31.027042,121.61698,31.026846,121.620627,31.026185,121.625784,31.02535,121.629537,31.025338,121.631144,31.025594,121.63504,31.025911,121.638487,31.026374,121.641516,31.027105,121.64268,31.027468,121.644113,31.028048,121.64622,31.028692,121.648608,31.029111,121.654186,31.029879,121.655524,31.030003,121.658454,31.030622,121.661112,31.031134,121.662387,31.031389,121.668029,31.032404,121.669322,31.032691,121.669829,31.032869,121.673382,31.03352,121.675896,31.03383,121.678873,31.034274,121.682414,31.034797,121.684466,31.035215,121.686876,31.035404,121.691884,31.036177,121.695117,31.036617,121.697524,31.037001,121.699266,31.037253,121.7019,31.037309,121.704024,31.03743,121.707804,31.037564,121.711445,31.037543,121.714839,31.037269,121.71693,31.037269,121.7188,31.037374,121.722603,31.037813,121.725826,31.038551,121.727941,31.038951,121.732353,31.040022,121.735674,31.040233,121.740397,31.040549,121.746645,31.040149,121.74908,31.040317,121.75127,31.040359,121.75368,31.040781,121.756657,31.041076,121.761133,31.041792,121.763741,31.042087,121.769399,31.041898,121.775327,31.041666,121.783199,31.041497,121.791285,31.041223,121.794999,31.041012,121.798197,31.041729,121.807945,31.040974,121.811411,31.040807,121.814571,31.038741,121.819235,31.036743,121.826704,31.035958,121.837144,31.036265,121.846933,31.037906,121.851596,31.038855,121.85917,31.040259
      ],
      datasnl:[121.538131,31.121888,121.538694,31.121658,121.543404,31.119179,121.543581,31.119142,121.54614,
      31.119091,121.551542,31.119105,121.557657,31.118931,121.561842,31.118628,121.562282,31.118628,121.567324,
      31.117525,121.569985,31.117819,121.575414,31.11911],
      datapunl:[121.505658,31.244205,121.506055,31.243343,121.506344,31.2431,121.507138,31.242902,121.507428,31.242801,121.507573,31.242668,121.508399,31.241467,121.508379,31.241501,121.509914,31.23918,121.51118,31.237089,121.513197,31.233983,121.514125,31.23252,121.514913,31.230828,121.515589,31.229213,121.517139,31.225474,121.517703,31.223534,121.518529,31.220882,121.518706,31.220185,121.518894,31.219378,121.51899,31.218001,121.518641,31.213666,121.518609,31.213092,121.518389,31.212487,121.518094,31.211817,121.516721,31.210101,121.516276,31.209431,121.515074,31.206977,121.51354,31.203067,121.512472,31.200539,121.51111,31.198474,121.508487,31.195175,121.507505,31.193697,121.503712,31.186864,121.502623,31.184919,121.501545,31.183418,121.498621,31.180187,121.497565,31.179407,121.496427,31.178906,121.495714,31.1787,121.494614,31.178516],
      radiusAll:[]
   
    }
  },
   computed: {
    
  },
  watch:{
    '$store.getters.userStation':{
      handler(val,oldval){
       if(val){
         MyMap.isTraffic(false)
         MyMap.pointAll3(val.slice(1,1000))
         MyMap.threeCircle(val,300)
          //  MyMap.addPolygon(this.$store.getters.threeMap)
          MyMap.addOverlayGroup(MyMap.threeCircle(val.slice(1,50),300))
          this.radiusAll=MyMap.threeCircle(val.slice(1,50),300)
          console.log(this.radiusAll)
        //  
         
       }
      },
    },
    '$store.getters.threeMap2':{
      handler(val,oldval){
       if(val){
         if(MyMap.polygonThree1){
            MyMap.polygonThree1.hide()
          }
          if(MyMap.polygonThree){
              MyMap.polygonThree.hide()
          }
          MyMap.addPolygon2(val)


       }
      },
    },
         
    '$store.getters.keyunData':{
      handler(val,oldval){
       if(val){
         this.judgeRoute(val)
       }
      },
    },
    '$route':{
      handler(val,oldval){
       if(val){
         this.judgeRoute(val)
       }
      },
    },
  },
  created(){
  },
  mounted(){
     MyMap = new Map({ el: "lineCharacteristics" });
    let nowroute=this.$route
    // let arr=[]
    // MyMap.addPolygon(arr)
    this.judgeRoute(nowroute)
  },
  methods:{
    //判断圆的面积
    judgeradius(){
      console.log(MyMap.mass.getData())
      console.log(this.radiusAll[0])
      console.log(this.radiusAll[0].contains([121.588339, 31.242512]))
      this.radiusAll.forEach(iteam=>{
        let arr=[]
        this.$store.getters.userStation.forEach(itam=>{
            if(iteam.contains(itam.lnglat)){
              arr.push(itam)
            }
        })
          console.log(arr)
      })
      // this.radiusAll.forEach(iteam.contains([121.588339, 31.242512]))

    },
    judgeRoute(val){
      switch(val.name) {
          case "道路网":
            MyMap.isTraffic(true)
             if(MyMap.mass){
                MyMap.isMass(false)
              }
              if(MyMap.keyunLaneGroups.getOverlays().length>0){
                 MyMap.keyunLaneGroups.hide()
                  MyMap.kyLineOver.hide()
                }
              
              break;
          case "公交站点":
              MyMap.isTraffic(false)
              if(MyMap.mass){
                MyMap.isMass(true)
              }
              if(MyMap.keyunLaneGroups.getOverlays().length>0){
                 MyMap.keyunLaneGroups.hide()
                  MyMap.kyLineOver.hide()
                }
              break;
          case "公交线路网":
              MyMap.isTraffic(false)
              if(MyMap.mass){
                MyMap.isMass(false)
              }
             if(MyMap.keyunLaneGroups.getOverlays().length>0){
                 MyMap.keyunLaneGroups.hide()
                  MyMap.kyLineOver.hide()
                }
              break;
          case "公交专用道":
              MyMap.isTraffic(false)
              if(MyMap.mass){
                MyMap.isMass(false)
              }
               if(MyMap.keyunLaneGroups.getOverlays().length>0){
                 MyMap.keyunLaneGroups.hide()
                  MyMap.kyLineOver.hide()
                }
              MyMap.heatmap.hide()
              break;
          case "客运走廊":
              MyMap.isTraffic(false)
              if(MyMap.mass){
                MyMap.isMass(false)
              }
              MyMap.heatmap.hide()
              let strky=MyMap.keyunLaneGroups.getOverlays()
              console.log('走到客运走廊')
              console.log(strky.length)
               if(strky.length>0){
                  MyMap.keyunLaneGroups.show()
                  MyMap.kyLineOver.show()
                }else{
                    MyMap.addOverlayGroup3(MyMap.addGjMarker(this.$store.getters.keyunData,2))
                    MyMap.addOverlayGroup3(MyMap.addGjMarker(this.$store.getters.keyunData1,1))
                    MyMap.addOverlayGroup4(MyMap.passCorrline(this.$store.getters.keyunData2))
                }
            
              break;
          default:
          } 
    },
    sonClick(row){
      // if(row.isbtn&&row.isbtn==1){
      //   MyMap.overlayGroups.show()
      //  MyMap.overlayGroups1.hide()
      // }else if(row.isbtn==2){
      //   let str=MyMap.overlayGroups1.getOverlays()
      //   if(str.length>0){
      //     MyMap.overlayGroups.hide()
      //     MyMap.overlayGroups1.show()
      //   }else{
      //     MyMap.overlayGroups.hide()
      //     MyMap.addOverlayGroup1(MyMap.threeCircle(this.$store.getters.userStation.slice(1,2),500))
      //   }
      // }


      if(row.isbtn==1){
        MyMap.polygonThree.show()
        MyMap.polygonThree1.hide()
      }else if(row.isbtn==2){
        if(MyMap.polygonThree1){
          MyMap.polygonThree.hide()
          MyMap.polygonThree1.show()
        }else{
          MyMap.polygonThree.hide()
          MyMap.addPolygon1(this.$store.getters.threeMap1)
        }

      }




      if(row.ispoint==1){
        MyMap.isMass(true)
      }else if(row.ispoint==2){
        MyMap.isMass(false)
      }

      if(row.isheat==1){
        MyMap.heatmap.hide()
      }else if(row.isheat==2){
        let arr=MyMap.heatmap.getDataSet()
        if(arr){
          MyMap.heatmap.show()
        }else{
          MyMap.setHeatemap(this.$store.getters.heatData)
        }
        
      }


      if(row.isinfobtn){
        MyMap.searchStation(row.isinfobtn.stationName,[row.isinfobtn.longitude==undefined?row.isinfobtn.lon:row.isinfobtn.longitude,row.isinfobtn.latitude==undefined?row.isinfobtn.lat:row.isinfobtn.latitude]) 
      }

      
      
    },
    separateArr(data, n) {
          //获取要切割的数组的长度
          let len = data.length;
          let lineNum = len % n === 0 ? len / n : Math.floor(len / n + 1);
          let res = [];
          for (let i = 0; i < lineNum; i++) {
              // slice() 方法返回一个从开始到结束（不包括结束）选择的数组的一部分浅拷贝到一个新数组对象。且原始数组不会被修改。
              let temp = data.slice(i * n, i * n + n);
              res.push(temp);
          }
          return res;
      },

     

    
    
  }
  
}
</script>
<style lang="scss">
.amap-info-contentContainer{
  .myinfobox{
  width: vw(316);
  height:100%;
  background: url("~@/assets/image/tk_bj.png");
  background-size: 100% 100%;
  box-sizing: border-box;
  padding: vh(10) vw(26);
  font-size: vw(16);
  padding-bottom: vh(34);
  display: flex;
  flex-direction: column;
  .infoimg{
    width: vw(48);
    height: vw(48);
    background: url("~@/assets/image/gf_icon.png");
    background-size: 100% 100%;
  }
  .line-lsi{
    display: flex;
    justify-content: flex-start;
    width: 100%;
    flex: 1;
    .tithear{
      width: vw(42);
      height:vh(20);
      display: inline-block;
    }
  }
  .titfont{
    display: flex;
    align-items: center;
    font-size: vw(22);
    color: #00FFFF;
    font-weight: bold;
    width: 100%;
    height: vh(30);
    margin: vh(10) vw(0);
    margin-left: vw(-12);
    margin-top: vh(18);
  }
}

}
</style>
<style lang="scss" scoped>

.lineCharacteristicsc{
  width: 100%;
  height: 100%;
}
</style>
